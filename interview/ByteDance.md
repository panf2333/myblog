# tiktok 隐私平台
## 一面 1.5hours
1. 聊项目
    1. 无感迁移在线方案
   > 里面的隐私平台干嘛的（脱敏，和场景的流程控制）
    2.  Q: 二维码签约方案   
        A: 缩短时间，二维码的时间和透出无业务意义内部映射减小透出字段。自己的页面去做维护
   >1. Q：安全性更多的考量？没想法面试官提出比如https加密传输
   >3. Q: 不调接口服务如何自己实现保证二维码的产生，刷新，与验证等

2. 算法
   1. 岛屿问题，BFS 和DFS 都可以让写用DFS
3. Q: google 查询问题的流程？
   A：DNS，HTTPS，HTTP，TCP，UDP
4. Q: 用户态和内核态定义
5. Q: 什么操作会调用内核态
   A：io，网络 （g）还有很多其他的


## 二面 1 hour
1. 自我介绍2分钟
2. 聊项目
Q：你项目中最有技术难度的地方  
A: 无感迁移项目。需求背景等等，，，和方案

Q：打断说的太细了，消息限流怎么设计的  
A: 令牌桶算法，简单的方案我用redis 设置个值，其他的client去请求原子性-1。拿到就可以去拉消息去请求。服务端起线程定时去put数据。因为高可用服务端多主去竞争分布式锁，竞争到的去初始化token数量。

Q：分布式锁怎么实现
A: 简单的redis.setNx 或者zookeeper答一下     

Q：client 是实现什么接口  
A：我内部封装，业务调用poll() 接口，然后poll里去拿令牌，然后去拉消息数据。业务端不需要感知具体逻辑（这个应该是他想确认的点） 

Q：如果redis的QPS撑不住了怎么办？这些服务怎么部署要单体还是集群？  
A：看需求，提供高可用服务是集群，QPS撑不住了就加机器分片和服务器的一致性hash路由这些。

Q：redis的集群机制，一致性hash是redis提供的吗
A：哨兵，还有后面的集群（集群我不清楚）但是我们可以自己有个client去实现一致性hash的路由逻辑，做成sdk

Q：回到限流。summary 一下方案   
A：重复下吧一些东西去掉


3. 做个系统设计，一个用户关注关系的系统，3个接口，关注、获取关注列表，被关注列表

A：考虑一下，简单做下，问下是否需要头像啥的（答不需要只要关系uid）。然后讲了一堆

Q: 打断，只要设计，比如表的schema，分片的细节  
A：表设计根据uid分片，冗余存两份数据。一个是关注表T1一个是被关注表T2。这样可以在一个分表里查询一个用户的所有信息。还有用户关注数和被关注数
```
schema 是 uid1，uid2（英文列名要对哈）
T1： uid1，uid2，时间。。。
T2： uid2, uid1, 时间。。。

schema是 uid，count1，count2
```


Q：分表可能出现一个更新失败怎么处理   
A: 关注请求过来后，我觉得不需要强一致，那就发两条消息最终一致，否则上强一致的分布式事务。

Q：消息怎么确保更新成功？   
A：  
1. 业务客户端失败重发，如果都失败做补偿把之前的发个补偿消息。
2. MQ服务端,没有得到消费成功的ACK就重发，等到一直失败就进死信队列，人工介入修复code或者重发


A：继续说，当用户的关注数太多千万网红的时候可能设置阈值去判断为热点账户自动迁徙到其他表，减小数据库的压力。这里的关注数统计等也要注意

Q：刚刚提到关注是热点更新，这个怎么操作  
A: 
1. 一个是更新可以先放缓存，等一定时间后同步到数据库，减小数据库压力。
2. 拆分字段记录，一行变多行，减小冲突，然后查询的时候汇总。


Q：太跳了，5年5份工作，有什么接口
A：bbb

Q：职业规划，想来这边得到什么
A：之前怎么样，现在想继续做后端，求稳定啥的

反问：
1. 面试后的建议： 太容易讲细节，差不多可以，感兴趣他会问
2. 团队规模：50人左右，还是比较稳的
3. 过去做什么： 后端开发，数据标注平台

   